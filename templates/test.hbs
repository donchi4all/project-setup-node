import {{singular service}}Service from "../src/api/services/{{singular service}}";
import Database, { sequelize } from './../src/modules/database';

describe('{{capitalizeSingular service}}Service', () => {

  beforeAll(() => {
    Database.init();
  });

  afterAll(async () => {
    await sequelize.close();
  });

  it('should create a new {{singular service}}', async () => {
    const new{{capitalizeSingular service}} = {
      name: "test {{singular service}}",
      someOtherString: "other {{singular service}} info",
      createdBy: "test admin"
    };

    const created{{capitalizeSingular service}} = await {{singular service}}Service.create(new{{capitalizeSingular service}});
    expect(created{{capitalizeSingular service}}).toBeDefined();
    expect(created{{capitalizeSingular service}}.id).toBeDefined();
    expect(created{{capitalizeSingular service}}.name).toBe(new{{capitalizeSingular service}}.name);
    expect(created{{capitalizeSingular service}}.someOtherString).toBe(new{{capitalizeSingular service}}.someOtherString);
    expect(created{{capitalizeSingular service}}.createdBy).toBe(new{{capitalizeSingular service}}.createdBy);
  });

  it('should return a list of {{plural service}}', async () => {
    const {{plural service}}List = await {{singular service}}Service.findAll();
    expect({{plural service}}List).toBeDefined();
    expect({{plural service}}List.data).toBeDefined();
    expect({{plural service}}List.pagination).toBeDefined();
    expect({{plural service}}List.data.length).toBeGreaterThan(0);
    expect({{plural service}}List.data[0].id).toBeDefined();
    expect({{plural service}}List.data[0].someOtherString).toBeDefined();
    expect({{plural service}}List.data[0].createdAt).toBeDefined();
    expect({{plural service}}List.data[0].createdBy).toBeDefined();
  });

  it('should return a single {{singular service}}', async () => {
    const list = await {{singular service}}Service.findAll();
    const {{singular service}}Item = await {{singular service}}Service.findOne(list.data[0].id);
    expect({{singular service}}Item).toBeDefined();
    expect({{singular service}}Item.id).toBeDefined();
    expect({{singular service}}Item.someOtherString).toBeDefined();
    expect({{singular service}}Item.createdAt).toBeDefined();
    expect({{singular service}}Item.createdBy).toBeDefined();
  });

  it('should update a {{singular service}} by id', async () => {
    const update{{capitalizeSingular service}} = {
      name: "test {{singular service}} update",
      someOtherString: "other {{singular service}} update info",
      createdBy: "new user"
    };
    const list = await {{singular service}}Service.findAll();
    const id = list.data[0].id;
    const updated{{capitalizeSingular service}} = await {{singular service}}Service.updateOne(update{{capitalizeSingular service}}, id);
    expect(updated{{capitalizeSingular service}}).toBeDefined();
    expect(updated{{capitalizeSingular service}}.id).toBe(id);
    expect(updated{{capitalizeSingular service}}.name).toBe(update{{capitalizeSingular service}}.name);
    expect(updated{{capitalizeSingular service}}.someOtherString).toBe(update{{capitalizeSingular service}}.someOtherString);
    expect(updated{{capitalizeSingular service}}.createdBy).toBe(update{{capitalizeSingular service}}.createdBy);
  });

  it('should update multiple {{plural service}} by ids', async () => {
    const update{{capitalizePlural service}} = {
      name: "test {{plural service}} update",
      someOtherString: "other {{plural service}} update info",
      createdBy: "new user"
    };
    const list = await {{singular service}}Service.findAll();
    const ids = list.data.map(item => item.id);
    const updated{{capitalizePlural service}} = await {{singular service}}Service.updateMany(update{{capitalizePlural service}}, ids);
    expect(updated{{capitalizePlural service}}).toBeDefined();
  });

  it('should delete a {{singular service}}', async () => {
    const list = await {{singular service}}Service.findAll();
    const deletedCount = await {{singular service}}Service.delete(list.data[0].id);
    expect(deletedCount).toBeGreaterThanOrEqual(0);
  });

  it('should delete multiple {{plural service}}', async () => {
    const list = await {{singular service}}Service.findAll();
    const ids = list.data.map(item => item.id);
    const deletedCount = await {{singular service}}Service.deleteMany(ids);
    expect(deletedCount).toBeGreaterThanOrEqual(0);
  });

});